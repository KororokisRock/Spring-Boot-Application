# Полное описание Endpoints

## Группа: Аутентификация и токены

### POST /auth/sing-in

1. Роль: Доступно без аутентификации
2. Описание: Аутентификация пользователя в системе и получение JWT токенов
3. Тело запроса (UserCredentialsDTO):

* username: string (обязательно, 2-50 символов) - имя пользователя
* password: string (обязательно, минимум 3 символа) - пароль пользователя

4. Пример curl:

```bash
curl -X POST "http://localhost:8080/auth/sing-in" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "Kororok",
    "password": "123"
  }'
```
5. Ответ:

```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

### POST /auth/refresh

1. Роль: Доступно без аутентификации
2. Описание: Обновление access токена с использованием refresh токена
3. Тело запроса (RefreshTokenDTO):

* refreshToken: string (обязательно) - refresh токен, полученный при аутентификации

4. Пример curl:
```bash
curl -X POST "http://localhost:8080/auth/refresh" \
  -H "Content-Type: application/json" \
  -d '{
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }'
```

5. Ответ:
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```
## Группа: Регистрация пользователей

### POST /register

1. Роль: Доступно без аутентификации
2. Описание: Регистрация нового пользователя в системе
3. Тело запроса (RegistrationDTO):

* username: string (обязательно, 2-50 символов, уникальный) - имя пользователя
* password: string (обязательно, минимум 3 символа) - пароль
* passwordConfirm: string (обязательно) - подтверждение пароля, должно совпадать с password

4. Пример curl:
```bash
curl -X POST "http://localhost:8080/register" \
  -H "Content-Type: application/json" \
  -d '{
    "username": "newuser",
    "password": "password123",
    "passwordConfirm": "password123"
  }'
```

5. Ответ:
```json
"Registration complete"
```
## Группа: Операции пользователей с картами

### POST /card/show

1. Роль: ROLE_USER
2. Описание: Получение пагинированного списка карт текущего пользователя с маскированными номерами
3. Тело запроса (FilterPageCardDTO):

* username: string (опционально) - фильтр по имени пользователя
* directionSort: string (опционально, по умолчанию "asc") - направление сортировки: "asc" или "desc"
* sortBy: string (опционально, по умолчанию "id") - поле для сортировки: "id", "card_number", "owner_id", "validity_period", "status", "balance"
* page: integer (опционально, по умолчанию 0) - номер страницы (0-based)
* size: integer (опционально, по умолчанию 10) - размер страницы
* cardNumber: string (опционально) - фильтр по номеру карты (частичное совпадение)
* minEndDate: string (date, опционально) - минимальная дата истечения срока действия
* maxEndDate: string (date, опционально) - максимальная дата истечения срока действия
* status: string (опционально) - фильтр по статусу: "ACTIVE", "BLOCKED", "EXPIRED"
* minBalance: number (опционально) - минимальный баланс
* maxBalance: number (опционально) - максимальный баланс

4. Пример curl:
```bash
curl -X POST "http://localhost:8080/card/show" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <token>" \
  -d '{
    "page": 0,
    "size": 10,
    "sortBy": "balance",
    "directionSort": "desc"
  }'
```
5. Ответ:
```json
{
  "content": [
    {
      "id": 1,
      "cardNumber": "************3456",
      "ownerId": 1,
      "validityPeriod": "2025-12-31",
      "status": "ACTIVE",
      "balance": 2000.0
    }
  ],
  "currentPage": 0,
  "totalPages": 1,
  "totalItems": 1,
  "pageSize": 10,
  "hasNext": false,
  "hasPrevious": false
}
```
### POST /card/show-full-number

1. Роль: ROLE_USER
2. Описание: Получение пагинированного списка карт текущего пользователя с полными номерами карт
3. Тело запроса (FilterPageCardDTO): (те же параметры что и для /card/show)

4. Пример curl:
```bash
curl -X POST "http://localhost:8080/card/show-full-number" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <token>" \
  -d '{
    "page": 0,
    "size": 10
  }'
```
5. Ответ:
```json
{
  "content": [
    {
      "id": 1,
      "cardNumber": "1234123412341234",
      "ownerId": 1,
      "validityPeriod": "2025-12-31",
      "status": "ACTIVE",
      "balance": 2000.0
    }
  ],
  "currentPage": 0,
  "totalPages": 1,
  "totalItems": 1,
  "pageSize": 10,
  "hasNext": false,
  "hasPrevious": false
}
```
### POST /card/transfer

1. Роль: ROLE_USER
2. Описание: Перевод денежных средств между двумя картами, принадлежащими текущему пользователю
3. Тело запроса (TransferBetweenCardsDTO):

* firstCardNumber: string (обязательно, 16 цифр) - номер карты списания
* secondCardNumber: string (обязательно, 16 цифр) - номер карты зачисления
* amountTransferBetweenCards: number (обязательно, положительное число) - сумма перевода

4. Пример curl:
```bash
curl -X POST "http://localhost:8080/card/transfer" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <token>" \
  -d '{
    "firstCardNumber": "1234123412341234",
    "secondCardNumber": "9876987698769876",
    "amountTransferBetweenCards": 100.0
  }'
```
5. Ответ:
```json
"Transfer between cards completed successfully"
```
## Группа: Административные операции с пользователями

### GET /user/all

1. Роль: ROLE_ADMIN
2. Описание: Получение списка всех зарегистрированных пользователей в системе
3. Тело запроса: отсутствует

4. Пример curl:
```bash
curl -X GET "http://localhost:8080/user/all" \
  -H "Authorization: Bearer <admin_token>"
```
5. Ответ:

```json
[
  {
    "id": 1,
    "username": "Kororok",
    "role": "ROLE_ADMIN"
  },
  {
    "id": 2,
    "username": "max",
    "role": "ROLE_USER"
  }
]
```
### POST /user/delete

1. Роль: ROLE_ADMIN
2. Описание: Удаление пользователя из системы по имени пользователя
3. Тело запроса (UsernameDTO):

* username: string (обязательно, 2-50 символов) - имя пользователя для удаления

4. Пример curl:

```bash
curl -X POST "http://localhost:8080/user/delete" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <admin_token>" \
  -d '{
    "username": "username_to_delete"
  }'
```
5. Ответ:

```json
"User delete successfully"
```
## Группа: Административные операции с картами

### GET /card/all

1. Роль: ROLE_ADMIN
2. Описание: Получение пагинированного списка всех карт в системе с возможностью фильтрации
3. Параметры запроса (в query string):

* username: string (опционально)
* directionSort: string (опционально)
* sortBy: string (опционально)
* page: integer (опционально)
* size: integer (опционально)
* cardNumber: string (опционально)
* minEndDate: string (опционально)
* maxEndDate: string (опционально)
* status: string (опционально)
* minBalance: number (опционально)
* maxBalance: number (опционально)

4. Пример curl:

```bash
curl -X GET "http://localhost:8080/card/all?page=0&size=10&sortBy=balance&directionSort=desc" \
  -H "Authorization: Bearer <admin_token>"
```
5. Ответ:

```json
{
  "content": [
    {
      "id": 1,
      "cardNumber": "1234123412341234",
      "ownerId": 1,
      "validityPeriod": "2025-12-31",
      "status": "ACTIVE",
      "balance": 2000.0
    },
    {
      "id": 2,
      "cardNumber": "9876987698769876",
      "ownerId": 2,
      "validityPeriod": "2025-12-31",
      "status": "ACTIVE",
      "balance": 1000.0
    }
  ],
  "currentPage": 0,
  "totalPages": 1,
  "totalItems": 2,
  "pageSize": 10,
  "hasNext": false,
  "hasPrevious": false
}
```
### POST /card/add

1. Роль: ROLE_ADMIN
2. Описание: Создание новой банковской карты для указанного пользователя
3. Тело запроса (NewCardDTO):

* cardNumber: string (обязательно, 16 цифр, уникальный) - номер карты
* ownerId: integer (обязательно, положительное число) - ID владельца карты
* validityPeriod: string (обязательно, date, будущая дата) - срок действия карты
* balance: number (опционально, по умолчанию 0.0, неотрицательное) - начальный баланс

4. Пример curl:
```bash
curl -X POST "http://localhost:8080/card/add" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <admin_token>" \
  -d '{
    "cardNumber": "1111222233334444",
    "ownerId": 2,
    "validityPeriod": "2026-12-31",
    "balance": 500.0
  }'
```
5. Ответ:

```json
"Card added"
```

### POST /card/block

1. Роль: ROLE_ADMIN
2. Описание: Блокировка банковской карты (изменение статуса на BLOCKED)
3. Тело запроса (CardNumberDTO):

* cardNumber: string (обязательно, 16 цифр) - номер карты для блокировки

4. Пример curl:

```bash
curl -X POST "http://localhost:8080/card/block" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <admin_token>" \
  -d '{
    "cardNumber": "1234123412341234"
  }'
```
5. Ответ:

```json
"Card blocked"
```
### POST /card/activate

1. Роль: ROLE_ADMIN
2. Описание: Активация банковской карты (изменение статуса на ACTIVE)
3. Тело запроса (CardNumberDTO):

* cardNumber: string (обязательно, 16 цифр) - номер карты для активации

4. Пример curl:

```bash
curl -X POST "http://localhost:8080/card/activate" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <admin_token>" \
  -d '{
    "cardNumber": "1234123412341234"
  }'
```
5. Ответ:
```json
"Card activated"
```
### POST /card/delete

1. Роль: ROLE_ADMIN
2. Описание: Удаление банковской карты из системы
3. Тело запроса (CardNumberDTO):

* cardNumber: string (обязательно, 16 цифр) - номер карты для удаления

4. Пример curl:
```bash
curl -X POST "http://localhost:8080/card/delete" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer <admin_token>" \
  -d '{
    "cardNumber": "1234123412341234"
  }'
```
5. Ответ:
```json
"Card deleted"
```